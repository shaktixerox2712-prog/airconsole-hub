<!DOCTYPE html>
<html>
<head>
<title>DesiConsole 3D Racing</title>
<style>
body { margin:0; overflow:hidden; background:black; }
#score {
 position:absolute;
 top:10px;
 left:50%;
 transform:translateX(-50%);
 color:white;
 font-family:Arial;
 font-size:20px;
}
</style>
</head>
<body>

<div id="score">Score: 0</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
/* FIREBASE CONFIG */
var firebaseConfig = {
  apiKey: "AIzaSyAOCz7nPegv2Rmf1FlpgZJQVUflwC-FFP8",
  authDomain: "airconsole-game-1c64b.firebaseapp.com",
  databaseURL: "https://airconsole-game-1c64b-default-rtdb.firebaseio.com",
  projectId: "airconsole-game-1c64b"
};

firebase.initializeApp(firebaseConfig);
var database = firebase.database();

var room = localStorage.getItem("room");
if(!room){ window.location.href="index.html"; }

/* THREE JS SETUP */
let scene = new THREE.Scene();
let camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
let renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

scene.background = new THREE.Color(0x000000);

let light = new THREE.DirectionalLight(0xffffff,1);
light.position.set(0,10,10);
scene.add(light);

/* ROAD */
let roadGeometry = new THREE.PlaneGeometry(10,500);
let roadMaterial = new THREE.MeshStandardMaterial({color:0x333333});
let road = new THREE.Mesh(roadGeometry, roadMaterial);
road.rotation.x = -Math.PI/2;
scene.add(road);

/* CAR */
let carGeometry = new THREE.BoxGeometry(1,0.5,2);
let carMaterial = new THREE.MeshStandardMaterial({color:0xff0000});
let car = new THREE.Mesh(carGeometry, carMaterial);
car.position.y = 0.25;
scene.add(car);

camera.position.set(0,3,5);

let speed = 0.5;
let score = 0;
let scoreDisplay = document.getElementById("score");

function animate(){
 requestAnimationFrame(animate);

 road.position.z += speed;
 if(road.position.z > 250) road.position.z = 0;

 score += 0.1;
 scoreDisplay.innerText = "Score: " + Math.floor(score);

 camera.position.x = car.position.x;
 camera.position.z = car.position.z + 5;
 camera.lookAt(car.position);

 renderer.render(scene,camera);
}

animate(if(moveLeft) car.position.x -= 0.3;
if(moveRight) car.position.x += 0.3;

/* Boundary limit */
if(car.position.x < -3) car.position.x = -3;
if(car.position.x > 3) car.position.x = 3;);

/* CONTROLLER LISTENER */
let moveLeft = false;
let moveRight = false;

database.ref("rooms/"+room+"/move").on("value", function(snapshot){
 var direction = snapshot.val();

 moveLeft = false;
 moveRight = false;

 if(direction === "left") moveLeft = true;
 if(direction === "right") moveRight = true;
});

/* KEYBOARD (backup) */
document.addEventListener("keydown", function(e){
 if(e.key === "ArrowLeft") car.position.x -= 0.7;
 if(e.key === "ArrowRight") car.position.x += 0.7;
});
</script>

</body>
</html>
