<!DOCTYPE html>
<html>
<head>
  <title>AirConsole Multiplayer</title>
  <style>
    body { margin:0; background:black; overflow:hidden; }
    #game { position:relative; width:100vw; height:80vh; }
    .player {
      position:absolute;
      width:50px;
      height:50px;
      background:red;
    }
    .controls {
      position:fixed;
      bottom:20px;
      left:50%;
      transform:translateX(-50%);
      display:grid;
      grid-template-columns:60px 60px 60px;
      gap:10px;
    }
    button {
      width:60px;
      height:60px;
      font-size:20px;
      border:none;
      border-radius:10px;
      background:orange;
    }
  </style>
</head>

<body>

<div id="game"></div>

<div class="controls">
  <div></div>
  <button onclick="move(0,-10)">⬆</button>
  <div></div>
  <button onclick="move(-10,0)">⬅</button>
  <button onclick="move(0,10)">⬇</button>
  <button onclick="move(10,0)">➡</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyAOCZ7nPegv2Rmf1FlpgZJQUVulwC-FFP8",
  authDomain: "airconsole-game-1c64b.firebaseapp.com",
  databaseURL: "https://airconsole-game-1c64b-default-rtdb.firebaseio.com",
  projectId: "airconsole-game-1c64b",
  storageBucket: "airconsole-game-1c64b.firebasestorage.app",
  messagingSenderId: "21762881860",
  appId: "1:21762881860:web:56a881305c3374bdfdbf11"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const playerId = Math.random().toString(36).substring(7);
const playerRef = ref(db, "players/" + playerId);

set(playerRef, { x: 100, y: 100 });

window.move = function(dx, dy) {
  onValue(playerRef, (snapshot) => {
    let data = snapshot.val();
    if (!data) return;
    data.x += dx;
    data.y += dy;
    set(playerRef, data);
  }, { onlyOnce: true });
};

onValue(ref(db, "players"), (snapshot) => {
  const game = document.getElementById("game");
  game.innerHTML = "";

  snapshot.forEach((child) => {
    const player = child.val();
    const div = document.createElement("div");
    div.className = "player";
    div.style.left = player.x + "px";
    div.style.top = player.y + "px";
    game.appendChild(div);
  });
});
</script>

</body>
</html>
